---
title: "A worked example"
author: "Andrew L Jackson"
output: rmarkdown::html_vignette
vignette: >
  %\VignetteIndexEntry{A worked example}
  %\VignetteEngine{knitr::rmarkdown}
  %\VignetteDepends{tidyverse}
  %\VignetteDepends{patchwork}
  \usepackage[utf8]{inputenc}
---


## Setup

```{r}
library(predictFishRMR)

# for plotting and tibble manipulation
library(tidyverse)


```

## Introduction

Here we use the functions in the package `predictFishRMR` to predict various features of a fishe's metabolism and ecological constraints based on their mass and physiology type. 

For this example we pick a mesotherm fish with mass = 2000g.

```{r}

# mass of fish
mm <- 2000

# range of water temperatures in C
Ta <- seq(0,30, by = 0.25)

# mesotherm (meso = T) or ecotherm (meso = F)?
mesotherm <- TRUE

# define our own kpars to use
kpars <- c(0.00174, -0.63180)

# Estimate the cooling coefficient K
# K <- kfun(m = mm)

# load the fitted regression model and extract the parameters
data("fittedModelRMR")
pars <- fittedModelRMR$fixef

# loop over the sequence of water temperatures in the vector Ta
# Estimate the body temperature at thermal equilibrium and take only the 
# first branch of the Lambert function estimates. 
Tm <- bodyTempLambert(Ta, m = mm, meso = mesotherm, 
                      pars = pars, kpars = kpars) |>
  filter(branch == 0)

# Estimate routine metabolic rate RMR over the range of  body temperatures
RMR <- RMRfun(mm, Tm$y, mesotherm, pars = pars)


# create a tibble for plotting in ggplot
dd <- tibble(Ta = Ta, Tm = Tm$y, RMR = RMR)

```

Plot the relationship between RMR and $T_a$

```{r, fig.width=5}

g1 <- ggplot(data = dd, mapping = aes(x = Ta, y = RMR)) + 
  geom_line() + 
  ggtitle(paste0("mass = ", mm, "kg")) 

print(g1)

```

Plot the relationship between RMR and $T_m$

```{r, fig.width=5}

g2 <- ggplot(data = dd, mapping = aes(x = Tm, y = RMR)) + 
  geom_line() + 
  ggtitle(paste0("mass = ", mm, "kg")) 

print(g2)

```



And body temperature $T_m$ relationship with ambient water temperature $T_a$

```{r}
g3 <- ggplot(data = dd, mapping = aes(x = Ta, y = Tm)) + 
  geom_line() + 
  ggtitle(paste0("mass = ", mm, "kg")) 

print(g3)
```

Panel plot

```{r}
library(patchwork)
g1 + g2 + g3 + plot_layout(nrow = 2, byrow = T)
```

